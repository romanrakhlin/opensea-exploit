{"ast":null,"code":"import parseSignatureHex from \"./ParseSignatureHex\";\n\nasync function signTypedDataAsync(provider, message, signerAddress) {\n  let signature;\n  return new Promise((resolve, reject) => {\n    const callback = async (err, result) => {\n      console.log(err);\n      if (err) reject(err);\n\n      if (result.error) {\n        reject(result.error.message);\n      }\n\n      ; // eslint-disable-next-line prefer-promise-reject-errors\n\n      if (result.error) return reject(\"ERROR\", result); // console.log(result);\n      // const d = result.result;\n      // let v = d.slice(-2);\n      // let r = d.slice(2, -66);\n      // let s = d.slice(-66, -2);\n      // let actualsignature = v + r + s + '03';\n\n      resolve(parseSignatureHex(result.result));\n    };\n\n    const stringified = JSON.stringify({ ...message\n    });\n\n    try {\n      // Using sign typed data V4 works with a stringified message, used by browser providers i.e. Metamask\n      provider.sendAsync({\n        method: \"eth_signTypedData_v4\",\n        params: [signerAddress, stringified],\n        from: signerAddress,\n        id: new Date().getTime()\n      }, callback);\n    } catch (error) {\n      console.log(error); // Fallback to normal sign typed data for node providers, without using stringified message\n      // https://github.com/coinbase/coinbase-wallet-sdk/issues/60\n\n      provider.sendAsync({\n        method: \"eth_signTypedData\",\n        params: [signerAddress, message],\n        from: signerAddress,\n        id: new Date().getTime()\n      }, callback);\n    }\n\n    ;\n  });\n}\n\n;\nexport default signTypedDataAsync;","map":{"version":3,"names":["parseSignatureHex","signTypedDataAsync","provider","message","signerAddress","signature","Promise","resolve","reject","callback","err","result","console","log","error","stringified","JSON","stringify","sendAsync","method","params","from","id","Date","getTime"],"sources":["/Users/romanrakhlin/Dropbox/Mac/Desktop/opensea-exploit/src/opensea-sdk/helpers/SignTypedDataAsync.js"],"sourcesContent":["import parseSignatureHex from \"./ParseSignatureHex\";\n\nasync function signTypedDataAsync(provider, message, signerAddress) {\n    let signature;\n    return new Promise((resolve, reject) => {\n        const callback = async (err, result) => {\n            console.log(err);\n            if (err) reject(err);\n            if (result.error) {\n                reject(result.error.message);\n            };\n\n            // eslint-disable-next-line prefer-promise-reject-errors\n            if (result.error) return reject(\"ERROR\", result);\n            // console.log(result);\n            // const d = result.result;\n\n            // let v = d.slice(-2);\n            // let r = d.slice(2, -66);\n            // let s = d.slice(-66, -2);\n\n            // let actualsignature = v + r + s + '03';\n            resolve(parseSignatureHex(result.result));\n        };\n\n        const stringified = JSON.stringify({ ...message });\n\n        try {\n            // Using sign typed data V4 works with a stringified message, used by browser providers i.e. Metamask\n            provider.sendAsync({\n                method: \"eth_signTypedData_v4\",\n                params: [signerAddress, stringified],\n                from: signerAddress,\n                id: new Date().getTime(),\n            }, callback);\n        } catch (error) {\n            console.log(error);\n\n            // Fallback to normal sign typed data for node providers, without using stringified message\n            // https://github.com/coinbase/coinbase-wallet-sdk/issues/60\n            provider.sendAsync({\n                method: \"eth_signTypedData\",\n                params: [signerAddress, message],\n                from: signerAddress,\n                id: new Date().getTime(),\n            }, callback);\n        };\n    });\n};\n\nexport default signTypedDataAsync;"],"mappings":"AAAA,OAAOA,iBAAP,MAA8B,qBAA9B;;AAEA,eAAeC,kBAAf,CAAkCC,QAAlC,EAA4CC,OAA5C,EAAqDC,aAArD,EAAoE;EAChE,IAAIC,SAAJ;EACA,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;IACpC,MAAMC,QAAQ,GAAG,OAAOC,GAAP,EAAYC,MAAZ,KAAuB;MACpCC,OAAO,CAACC,GAAR,CAAYH,GAAZ;MACA,IAAIA,GAAJ,EAASF,MAAM,CAACE,GAAD,CAAN;;MACT,IAAIC,MAAM,CAACG,KAAX,EAAkB;QACdN,MAAM,CAACG,MAAM,CAACG,KAAP,CAAaX,OAAd,CAAN;MACH;;MAAA,CALmC,CAOpC;;MACA,IAAIQ,MAAM,CAACG,KAAX,EAAkB,OAAON,MAAM,CAAC,OAAD,EAAUG,MAAV,CAAb,CARkB,CASpC;MACA;MAEA;MACA;MACA;MAEA;;MACAJ,OAAO,CAACP,iBAAiB,CAACW,MAAM,CAACA,MAAR,CAAlB,CAAP;IACH,CAlBD;;IAoBA,MAAMI,WAAW,GAAGC,IAAI,CAACC,SAAL,CAAe,EAAE,GAAGd;IAAL,CAAf,CAApB;;IAEA,IAAI;MACA;MACAD,QAAQ,CAACgB,SAAT,CAAmB;QACfC,MAAM,EAAE,sBADO;QAEfC,MAAM,EAAE,CAAChB,aAAD,EAAgBW,WAAhB,CAFO;QAGfM,IAAI,EAAEjB,aAHS;QAIfkB,EAAE,EAAE,IAAIC,IAAJ,GAAWC,OAAX;MAJW,CAAnB,EAKGf,QALH;IAMH,CARD,CAQE,OAAOK,KAAP,EAAc;MACZF,OAAO,CAACC,GAAR,CAAYC,KAAZ,EADY,CAGZ;MACA;;MACAZ,QAAQ,CAACgB,SAAT,CAAmB;QACfC,MAAM,EAAE,mBADO;QAEfC,MAAM,EAAE,CAAChB,aAAD,EAAgBD,OAAhB,CAFO;QAGfkB,IAAI,EAAEjB,aAHS;QAIfkB,EAAE,EAAE,IAAIC,IAAJ,GAAWC,OAAX;MAJW,CAAnB,EAKGf,QALH;IAMH;;IAAA;EACJ,CA3CM,CAAP;AA4CH;;AAAA;AAED,eAAeR,kBAAf"},"metadata":{},"sourceType":"module"}