{"ast":null,"code":"// sourced from 0x.js:\n// https://github.com/ProjectWyvern/wyvern-js/blob/39999cb93ce5d80ea90b4382182d1bd4339a9c6c/src/utils/signature_utils.ts\nconst parseSignatureHex = async signature => {\n  // HACK: There is no consensus on whether the signatureHex string should be formatted as\n  // v + r + s OR r + s + v, and different clients (even different versions of the same client)\n  // return the signature params in different orders. In order to support all client implementations,\n  // we parse the signature in both ways, and evaluate if either one is a valid signature.\n  const validVParamValues = [27, 28];\n\n  const ecSignatureRSV = _parseSignatureHexAsRSV(signature);\n\n  if (_.includes(validVParamValues, ecSignatureRSV.v)) {\n    return ecSignatureRSV;\n  }\n\n  ; // For older clients\n\n  const ecSignatureVRS = _parseSignatureHexAsVRS(signature);\n\n  if (_.includes(validVParamValues, ecSignatureVRS.v)) {\n    return ecSignatureVRS;\n  }\n\n  ;\n  throw new Error(\"Invalid signature\");\n\n  function _parseSignatureHexAsVRS(signatureHex) {\n    const signatureBuffer = ethUtil.toBuffer(signatureHex);\n    let v = signatureBuffer[0];\n\n    if (v < 27) {\n      v += 27;\n    }\n\n    const r = signatureBuffer.slice(1, 33);\n    const s = signatureBuffer.slice(33, 65);\n    const ecSignature = {\n      v,\n      r: ethUtil.bufferToHex(r),\n      s: ethUtil.bufferToHex(s)\n    };\n    return ecSignature;\n  }\n\n  ;\n\n  function _parseSignatureHexAsRSV(signatureHex) {\n    const {\n      v,\n      r,\n      s\n    } = ethUtil.fromRpcSig(signatureHex);\n    const ecSignature = {\n      v,\n      r: ethUtil.bufferToHex(r),\n      s: ethUtil.bufferToHex(s)\n    };\n    return ecSignature;\n  }\n\n  ;\n};\n\nexport default parseSignatureHex;","map":{"version":3,"names":["parseSignatureHex","signature","validVParamValues","ecSignatureRSV","_parseSignatureHexAsRSV","_","includes","v","ecSignatureVRS","_parseSignatureHexAsVRS","Error","signatureHex","signatureBuffer","ethUtil","toBuffer","r","slice","s","ecSignature","bufferToHex","fromRpcSig"],"sources":["/Users/romanrakhlin/Dropbox/Mac/Desktop/opensea-exploit/src/opensea-sdk/helpers/ParseSignatureHex.js"],"sourcesContent":["// sourced from 0x.js:\n// https://github.com/ProjectWyvern/wyvern-js/blob/39999cb93ce5d80ea90b4382182d1bd4339a9c6c/src/utils/signature_utils.ts\nconst parseSignatureHex = async(signature) => {\n    // HACK: There is no consensus on whether the signatureHex string should be formatted as\n    // v + r + s OR r + s + v, and different clients (even different versions of the same client)\n    // return the signature params in different orders. In order to support all client implementations,\n    // we parse the signature in both ways, and evaluate if either one is a valid signature.\n    const validVParamValues = [27, 28];\n\n    const ecSignatureRSV = _parseSignatureHexAsRSV(signature);\n    if (_.includes(validVParamValues, ecSignatureRSV.v)) {\n        return ecSignatureRSV;\n    };\n\n    // For older clients\n    const ecSignatureVRS = _parseSignatureHexAsVRS(signature);\n    if (_.includes(validVParamValues, ecSignatureVRS.v)) {\n        return ecSignatureVRS;\n    };\n\n    throw new Error(\"Invalid signature\");\n\n    function _parseSignatureHexAsVRS(signatureHex) {\n        const signatureBuffer = ethUtil.toBuffer(signatureHex);\n        let v = signatureBuffer[0];\n\n        if (v < 27) {\n            v += 27;\n        }\n\n        const r = signatureBuffer.slice(1, 33);\n        const s = signatureBuffer.slice(33, 65);\n        const ecSignature = {\n            v,\n            r: ethUtil.bufferToHex(r),\n            s: ethUtil.bufferToHex(s),\n        };\n\n        return ecSignature;\n    };\n\n    function _parseSignatureHexAsRSV(signatureHex) {\n        const { v, r, s } = ethUtil.fromRpcSig(signatureHex);\n        const ecSignature = {\n            v,\n            r: ethUtil.bufferToHex(r),\n            s: ethUtil.bufferToHex(s),\n        };\n\n        return ecSignature;\n    };\n};\n\nexport default parseSignatureHex;"],"mappings":"AAAA;AACA;AACA,MAAMA,iBAAiB,GAAG,MAAMC,SAAN,IAAoB;EAC1C;EACA;EACA;EACA;EACA,MAAMC,iBAAiB,GAAG,CAAC,EAAD,EAAK,EAAL,CAA1B;;EAEA,MAAMC,cAAc,GAAGC,uBAAuB,CAACH,SAAD,CAA9C;;EACA,IAAII,CAAC,CAACC,QAAF,CAAWJ,iBAAX,EAA8BC,cAAc,CAACI,CAA7C,CAAJ,EAAqD;IACjD,OAAOJ,cAAP;EACH;;EAAA,CAVyC,CAY1C;;EACA,MAAMK,cAAc,GAAGC,uBAAuB,CAACR,SAAD,CAA9C;;EACA,IAAII,CAAC,CAACC,QAAF,CAAWJ,iBAAX,EAA8BM,cAAc,CAACD,CAA7C,CAAJ,EAAqD;IACjD,OAAOC,cAAP;EACH;;EAAA;EAED,MAAM,IAAIE,KAAJ,CAAU,mBAAV,CAAN;;EAEA,SAASD,uBAAT,CAAiCE,YAAjC,EAA+C;IAC3C,MAAMC,eAAe,GAAGC,OAAO,CAACC,QAAR,CAAiBH,YAAjB,CAAxB;IACA,IAAIJ,CAAC,GAAGK,eAAe,CAAC,CAAD,CAAvB;;IAEA,IAAIL,CAAC,GAAG,EAAR,EAAY;MACRA,CAAC,IAAI,EAAL;IACH;;IAED,MAAMQ,CAAC,GAAGH,eAAe,CAACI,KAAhB,CAAsB,CAAtB,EAAyB,EAAzB,CAAV;IACA,MAAMC,CAAC,GAAGL,eAAe,CAACI,KAAhB,CAAsB,EAAtB,EAA0B,EAA1B,CAAV;IACA,MAAME,WAAW,GAAG;MAChBX,CADgB;MAEhBQ,CAAC,EAAEF,OAAO,CAACM,WAAR,CAAoBJ,CAApB,CAFa;MAGhBE,CAAC,EAAEJ,OAAO,CAACM,WAAR,CAAoBF,CAApB;IAHa,CAApB;IAMA,OAAOC,WAAP;EACH;;EAAA;;EAED,SAASd,uBAAT,CAAiCO,YAAjC,EAA+C;IAC3C,MAAM;MAAEJ,CAAF;MAAKQ,CAAL;MAAQE;IAAR,IAAcJ,OAAO,CAACO,UAAR,CAAmBT,YAAnB,CAApB;IACA,MAAMO,WAAW,GAAG;MAChBX,CADgB;MAEhBQ,CAAC,EAAEF,OAAO,CAACM,WAAR,CAAoBJ,CAApB,CAFa;MAGhBE,CAAC,EAAEJ,OAAO,CAACM,WAAR,CAAoBF,CAApB;IAHa,CAApB;IAMA,OAAOC,WAAP;EACH;;EAAA;AACJ,CAjDD;;AAmDA,eAAelB,iBAAf"},"metadata":{},"sourceType":"module"}